define ("qtype_geogebra/ggbt",["jquery","qtype_geogebra/deployggb"],function(a,b){var c=M.cfg.wwwroot+"/question/type/geogebra/js/geogebra-math-apps-bundle/GeoGebra/HTML5/5.0/web3d/";return{init:function init(){window.GGBT=this;window.ggbAppletOnLoad=function(){a("input[name=\"ggbparameters\"]").val(JSON.stringify(window.applet1.getParameters()));a("input[name=\"ggbviews\"]").val(JSON.stringify(window.applet1.getViews()));a("input[name=\"ggbcodebaseversion\"]").val(window.applet1.getHTML5CodebaseVersion());if("undefined"==typeof this.ggbcheckb){var b=document.ggbApplet;a("input[name=\"ggbxml\"]").val(b.getXML());a("input[name=\"ggbexercise\"]").val(JSON.stringify(b.getExerciseResult()));var c=document.getElementById("id_randomizedvar");if(!c.value){window.GGBT.getrandvars()}var d=0,e=a("#id_answer_"+d);while(e[0]!==void 0){if(e.val()){e.on("change focus",function(b){b.preventDefault();window.GGBT.update_feedback(a(b.target))});window.GGBT.update_feedback(e)}e=a("#id_answer_"+ ++d)}document.querySelector("article").onkeypress=window.GGBT.checkEnter}if(window.GGBT.usefile.checked){document.getElementById("applet_container1").style.display="block";document.getElementById("applet_options").style.display="flex"}};if(a("#applet_parameters")[0]!==void 0){this.ggbDataset=a("#applet_parameters")[0].dataset;this.parameters=JSON.parse(this.ggbDataset.parameters);this.views=this.ggbDataset.views;window.applet1=new b(this.parameters,this.views,!0);window.applet1.setHTML5Codebase(c);this.lang=this.ggbDataset.lang}a("#id_loadapplet").on("click",function(b){b.preventDefault();var c=a("#id_ggbturl").val().split("/").pop();if(0==c.indexOf("m")){if(window.GGBT.isNumber(c.substr(1))||!window.GGBT.isNumber(c.substr(1))&&8<c.length){c=c.substr(1)}}window.GGBT.injectapplet(c)});a("#id_getvars").on("click",function(a){a.preventDefault();window.GGBT.getrandvars()});if(this.parameters){window.applet1.inject("applet_container1","preferHTML5")}this.ggbf=document.getElementById("id_ggbtheader");this.usefile=document.getElementById("id_usefile");if(null===this.ggbf){this.ggbf=document.getElementById("id_submissiontypes");this.ggbcheckb=document.getElementById("id_assignsubmission_geogebra_enabled");if(null!==this.ggbcheckb){this.ggbcheckb.addEventListener("change",this.handleggbdisable,!1)}}if(null!==this.ggbf){this.ggbf.addEventListener("dragenter",this.handleDragEnter,!1);this.ggbf.addEventListener("dragover",this.handleDragOver,!1);this.ggbf.addEventListener("dragleave",this.handleDragEndLeave,!1);this.ggbf.addEventListener("dragend",this.handleDragEndLeave,!1);this.ggbf.addEventListener("drop",this.handleDrop,!1);this.usefile.addEventListener("change",this.handleusefile,!1)}if(this.usefile.checked){document.getElementById("applet_options").style.display="block"}else{document.getElementById("applet_options").style.display="none"}this.initoptions()},callback:function callback(b){var c=M.core_filepicker.instances[b.client_id].options.elementname;a("#id_"+c).val(b.url);var d=b.file.split(".")[0];if(0==d.indexOf("m")){if(this.isNumber(d.substr(1))||!this.isNumber(d.substr(1))&&8<d.length){d=d.substr(1)}}this.injectapplet(d)},injectapplet:function injectapplet(a){this.parameters={material_id:a};this.parameters.language=this.lang;this.parameters.moodle="editingQuestionOrSubmission";this.parameters.useBrowserForJS=!1;document.getElementById("applet_container1").style.display="block";window.applet1=new b(this.parameters,!0);window.applet1.setHTML5Codebase(c);window.applet1.inject("applet_container1","preferHTML5")},getrandvars:function getrandvars(){var b=document.ggbApplet;if("undefined"!=typeof b){for(var c=b.getObjectNumber(),d=document.getElementById("id_randomizedvar"),e="",f=0,g=0,h;g<c;g++){h=b.getObjectName(g);if("numeric"==b.getObjectType(h)&&b.isIndependent(h)){e+=h+","}else{var k=a("#id_answer_"+f);if("boolean"==b.getObjectType(h)){if(null!==k){if(!k.val()){k.val(h)}this.update_feedback(k);f++}}}d.value=e}}},update_feedback:function update_feedback(b){var c=b.attr("id").split("_").pop(),d=b.val(),e=a("input[name=\"feedback["+c+"]\"]"),f=a("#id_feedbackfromfile_"+c),g=a.parseXML(window.ggbApplet.getXML(d));if(g){var h=g.getElementsByTagName("caption"),i="";if(1==h.length){i=h[0].getAttribute("val");e.val(i)}else if(1<h.length){e.val("");i=""}else{e.val("");i="Caption not set or variable name wrong."}f.val(i)}},checkEnter:function checkEnter(a){a=a||event;var b=/textarea/i.test((a.target||a.srcElement).tagName);return b||13!==(a.keyCode||a.which||a.charCode||0)},initoptions:function initoptions(){this.enable_right_click=document.getElementById("enableRightClick");this.enable_label_drags=document.getElementById("enableLabelDrags");this.show_reset_icon=document.getElementById("showResetIcon");this.enable_shift_drag_zoom=document.getElementById("enableShiftDragZoom");this.show_algebra_input=document.getElementById("showAlgebraInput");this.show_menu_bar=document.getElementById("showMenuBar");this.show_tool_bar=document.getElementById("showToolBar");if("undefined"!=typeof parameters){this.enable_right_click.checked=this.parameters.enableRightClick;this.enable_label_drags.checked=this.parameters.enableLabelDrags;this.show_reset_icon.checked=this.parameters.showResetIcon;this.enable_shift_drag_zoom.checked=this.parameters.enableShiftDragZoom;this.show_algebra_input.checked=this.parameters.showAlgebraInput;this.show_menu_bar.checked=this.parameters.showMenuBar;this.show_tool_bar.checked=this.parameters.showToolBar}this.enable_right_click.addEventListener("change",this.handlesettingschanged,!1);this.enable_label_drags.addEventListener("change",this.handlesettingschanged,!1);this.show_reset_icon.addEventListener("change",this.handlesettingschanged,!1);this.enable_shift_drag_zoom.addEventListener("change",this.handlesettingschanged,!1);this.show_algebra_input.addEventListener("change",this.handlesettingschanged,!1);this.show_menu_bar.addEventListener("change",this.handlesettingschanged,!1);this.show_tool_bar.addEventListener("change",this.handlesettingschanged,!1)},handlesettingschanged:function handlesettingschanged(d){window.GGBT.parameters[d.target.id]=d.target.checked;a("input[name=\"ggbparameters\"]").val(JSON.stringify(window.GGBT.parameters));if("showToolBar"==d.target.id||"showMenuBar"==d.target.id||"showAlgebraInput"==d.target.id){window.applet1=new b(window.GGBT.parameters,!0);window.applet1.setHTML5Codebase(c);window.applet1.inject("applet_container1","preferHTML5")}else{window.ggbApplet[d.target.id](d.target.checked)}},handleusefile:function handleusefile(){if(!window.GGBT.usefile.checked){document.getElementById("applet_container1").style.display="none";document.getElementById("applet_options").style.display="none"}else{document.getElementById("id_ggbturl").value=""}},handleggbdisable:function handleggbdisable(){if(!window.GGBT.ggbcheckb.checked){document.getElementById("applet_container1").style.display="none";document.getElementById("applet_options").style.display="none";if(window.GGBT.usefile.checked){window.GGBT.usefile.click()}}else{document.getElementById("applet_container1").style.display="block"}},handleDragEnter:function handleDragEnter(){if("undefined"==typeof ggbcheckb||window.GGBT.ggbcheckb.checked){window.GGBT.ggbf.classList.add("qtype-geogebra-hover");document.getElementById("applet_container1").style.visibility="hidden"}},handleDragOver:function handleDragOver(a){if("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked){if(a.preventDefault){a.preventDefault()}window.GGBT.ggbf.classList.add("qtype-geogebra-hover");document.getElementById("applet_container1").style.visibility="hidden";return!1}},handleDragEndLeave:function handleDragEndLeave(){if("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked){window.GGBT.ggbf.classList.remove("qtype-geogebra-hover");document.getElementById("applet_container1").style.removeProperty("visibility")}},handleDrop:function handleDrop(a){if("undefined"==typeof window.GGBT.ggbcheckb||window.GGBT.ggbcheckb.checked){a.preventDefault();a.stopPropagation();var d=a.dataTransfer.files[0];window.GGBT.ggbf.classList.remove("qtype-geogebra-hover");document.getElementById("applet_container1").style.removeProperty("visibility");document.getElementById("applet_container1").style.display="block";document.getElementById("applet_options").style.display="flex";document.getElementById("applet_container1").style.height="100%";document.getElementById("id_ggbturl").value="";if(!window.GGBT.usefile.checked){window.GGBT.usefile.click()}var e=new FileReader;e.onload=function(a){var d=a.target.result.replace("data:application/vnd.geogebra.file;base64,","");window.GGBT.parameters={ggbBase64:d};window.GGBT.parameters.enableRightClick=window.GGBT.enable_right_click.checked;window.GGBT.parameters.enableLabelDrags=window.GGBT.enable_label_drags.checked;window.GGBT.parameters.showResetIcon=window.GGBT.show_reset_icon.checked;window.GGBT.parameters.enableShiftDragZoom=window.GGBT.enable_shift_drag_zoom.checked;window.GGBT.parameters.showAlgebraInput=window.GGBT.show_algebra_input.checked;window.GGBT.parameters.showMenuBar=window.GGBT.show_menu_bar.checked;window.GGBT.parameters.showToolBar=window.GGBT.show_tool_bar.checked;window.GGBT.parameters.moodle="editingQuestionOrSubmission";window.applet1=new b(window.GGBT.parameters,!0);window.applet1.setHTML5Codebase(c);window.applet1.inject("applet_container1")};e.readAsDataURL(d)}},isNumber:function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}}});
//# sourceMappingURL=ggbt.min.js.map
