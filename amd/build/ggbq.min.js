define(["jquery","//www.geogebra.org/apps/deployggb.js"],function(a,o){return{b64input:[],ggbBase64:[],xmlinput:[],ggbxml:[],currentvals:[],answerinput:[],responsevars:[],exerciseresultinput:[],qdiv:[],ggbDataset:[],init:function(e){window.GGBQ=this;var t=document.getElementById(e).dataset,n=t.slot;window.ggbAppletOnLoad=function(e){if(-1!=e){document.querySelector("article").onkeydown=this.checkEnter;var t=e.substring(9),n=window[e];for(var i in window.GGBQ.currentvals[t])n.setValue(i,window.GGBQ.currentvals[t][i]);window.GGBQ.b64input[t].val(n.getBase64()),window.GGBQ.xmlinput[t].val(n.getXML());var s,r=n.startExercise();for(var a in r)window.GGBQ.qdiv[t].innerHTML=window.GGBQ.qdiv[t].innerHTML.replace("{"+a+"}",r[a]);window.GGBQ.qdiv[t].style.visibility="visible",""==window.GGBQ.answerinput[t].val()&&(s="",window.GGBQ.responsevars[t].forEach(function(e){n.isDefined(e)?s+=n.getValue(e):s+=0}),window.GGBQ.answerinput[t].val(s))}},this.b64input[n]=a(document.getElementById(t.b64input)),this.ggbBase64[n]=this.b64input[n].val(),this.xmlinput[n]=a(document.getElementById(t.xmlinput)),this.ggbxml[n]=this.xmlinput[n].val(),this.qdiv[n]=a("#q"+n+" .qtext")[0];var i=JSON.parse(t.parameters);""!=this.ggbBase64[n]&&(i.ggbBase64=this.ggbBase64[n]),i.language=t.lang,i.moodle="takingQuiz",delete i.material_id,i.id="ggbApplet"+n;var s=JSON.parse(t.views),r=new o(i,s,t.html5NoWebSimple);r.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d"),r.inject(t.div,"preferHTML5"),a("#responseform").on("submit",this.getBase64andCheck),a(document.getElementById(t.div)).on("mouseleave",this.getBase64andCheck),document.getElementsByClassName("ggb_preview")[0].style.zIndex=-1,this.currentvals[n]=t.vars,this.answerinput[n]=a(document.getElementById(t.answerinput)),this.exerciseresultinput[n]=a(document.getElementById(t.exerciseresultinput)),this.responsevars[n]=JSON.parse(t.responsevars)},checkEnter:function(e){return e=e||event,/textarea/i.test((e.target||e.srcElement).tagName)||13!==(e.keyCode||e.which||e.charCode||0)},getBase64andCheck:function(){for(var e=0;e<window.GGBQ.answerinput.length;e++){var t=window["ggbApplet"+e];if(void 0!==t){window.GGBQ.b64input[e].val(t.getBase64()),window.GGBQ.xmlinput[e].val(t.getXML());for(var n="",i=0;i<window.GGBQ.responsevars[e].length;i++)t.isDefined(window.GGBQ.responsevars[e][i])?n+=t.getValue(window.GGBQ.responsevars[e][i]):n+=0;window.GGBQ.answerinput[e].val(n),window.GGBQ.exerciseresultinput[e].val(JSON.stringify(t.getExerciseResult()))}}}}});
