{"version":3,"sources":["../src/ggbt.js"],"names":["define","$","GGBApplet","GGBcodebase","M","cfg","wwwroot","init","window","GGBT","ggbAppletOnLoad","val","JSON","stringify","applet1","getParameters","getViews","getHTML5CodebaseVersion","ggbcheckb","applet","document","ggbApplet","getXML","randomizedvar","getElementById","value","getrandvars","i","answer","on","e","preventDefault","update_feedback","target","querySelector","onkeypress","checkEnter","usefile","checked","style","display","ggbDataset","dataset","parameters","parse","views","setHTML5Codebase","lang","id","split","pop","indexOf","isNumber","substr","length","injectapplet","inject","ggbf","addEventListener","handleggbdisable","handleDragEnter","handleDragOver","handleDragEndLeave","handleDrop","handleusefile","initoptions","callback","params","elementname","core_filepicker","instances","options","url","file","language","moodle","useBrowserForJS","objNumber","getObjectNumber","stringforrandomizedvars","j","strName","getObjectName","getObjectType","isIndependent","answernode","attr","varname","feedback","feedbackfromfile","doc","parseXML","elem","getElementsByTagName","fbstring","getAttribute","event","txtArea","test","srcElement","tagName","keyCode","which","charCode","enable_right_click","enable_label_drags","show_reset_icon","enable_shift_drag_zoom","show_algebra_input","show_menu_bar","show_tool_bar","enableRightClick","enableLabelDrags","showResetIcon","enableShiftDragZoom","showAlgebraInput","showMenuBar","showToolBar","handlesettingschanged","evt","click","classList","add","visibility","remove","removeProperty","stopPropagation","dataTransfer","files","height","reader","FileReader","onload","base64","result","replace","readAsDataURL","n","isNaN","parseFloat","isFinite"],"mappings":"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","sourcesContent":["/**\n * Javascript Controller to embed GGBApplet\n *\n * This class provides all the functionality for the new assign module.\n *\n * @author         Christoph Stadlbauer <christoph.stadlbauer@geogebra.org>\n * @copyright  (c) International GeoGebra Institute 2018\n * @license        http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'qtype_geogebra/deployggb'], function($, GGBApplet) {\n    /**\n     * Created by Christoph on 25.08.19.\n     */\n\n    /**\n     * GGB Codebase: necessary for loading GGB-Bundle locally.\n     * @type {string}\n     */\n    const GGBcodebase = M.cfg.wwwroot +\n        '/question/type/geogebra/js/geogebra-math-apps-bundle/GeoGebra/HTML5/5.0/web3d/';\n\n    return {\n\n        init: function() {\n            window.GGBT = this;\n            window.ggbAppletOnLoad = function() {\n                $('input[name=\"ggbparameters\"]').val(JSON.stringify(window.applet1.getParameters()));\n                $('input[name=\"ggbviews\"]').val(JSON.stringify(window.applet1.getViews()));\n                $('input[name=\"ggbcodebaseversion\"]').val(window.applet1.getHTML5CodebaseVersion());\n\n                if (typeof (this.ggbcheckb) == \"undefined\") {\n                    var applet = document.ggbApplet;\n                    $('input[name=\"ggbxml\"]').val(applet.getXML());\n\n                    var randomizedvar = document.getElementById('id_randomizedvar');\n                    if (!randomizedvar.value) {\n                        window.GGBT.getrandvars();\n                    }\n\n                    var i = 0;\n                    var answer = $('#id_answer_' + i);\n                    while (answer[0] !== undefined) {\n                        if (answer.val()) {\n                            answer.on('change focus', function(e) {\n                                e.preventDefault();\n                                window.GGBT.update_feedback($(e.target));\n                            });\n                            window.GGBT.update_feedback(answer);\n                        }\n                        answer = $('#id_answer_' + ++i);\n                    }\n                    document.querySelector('article').onkeypress = window.GGBT.checkEnter;\n                }\n                if (window.GGBT.usefile.checked) {\n                    document.getElementById('applet_container1').style.display = \"block\";\n                    document.getElementById('applet_options').style.display = \"flex\";\n                }\n            };\n\n            if ($('#applet_parameters')[0] !== undefined) {\n                this.ggbDataset = $('#applet_parameters')[0].dataset;\n                this.parameters = JSON.parse(this.ggbDataset.parameters);\n                this.views = this.ggbDataset.views;\n                window.applet1 = new GGBApplet(this.parameters, this.views, true);\n                window.applet1.setHTML5Codebase(GGBcodebase);\n                // window.applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.410.0/web3d\");\n                this.lang = this.ggbDataset.lang;\n            }\n\n            $('#id_loadapplet').on('click', function(e) {\n                e.preventDefault();\n                var id = $('#id_ggbturl').val().split(\"/\").pop();\n                if (id.indexOf(\"m\") == 0) {\n                    if (window.GGBT.isNumber(id.substr(1)) || (!window.GGBT.isNumber(id.substr(1)) && id.length > 8)) {\n                        id = id.substr(1);\n                    }\n                }\n                window.GGBT.injectapplet(id);\n            });\n\n            $('#id_getvars').on('click', function(e) {\n                e.preventDefault();\n                window.GGBT.getrandvars();\n            });\n\n            if (this.parameters) {\n                window.applet1.setHTML5Codebase(GGBcodebase);\n                window.applet1.inject(\"applet_container1\", \"preferHTML5\");\n            }\n\n            this.ggbf = document.getElementById('id_ggbtheader');\n            this.usefile = document.getElementById(\"id_usefile\");\n\n            if (this.ggbf === null) { // In this case we are editing a submission.\n                this.ggbf = document.getElementById('id_submissiontypes');\n                this.ggbcheckb = document.getElementById('id_assignsubmission_geogebra_enabled');\n                if (this.ggbcheckb !== null) {\n                    this.ggbcheckb.addEventListener('change', this.handleggbdisable, false);\n                }\n            }\n\n            if (this.ggbf !== null) {\n                this.ggbf.addEventListener('dragenter', this.handleDragEnter, false);\n                this.ggbf.addEventListener('dragover', this.handleDragOver, false);\n                this.ggbf.addEventListener('dragleave', this.handleDragEndLeave, false);\n                this.ggbf.addEventListener('dragend', this.handleDragEndLeave, false);\n                this.ggbf.addEventListener('drop', this.handleDrop, false);\n                this.usefile.addEventListener('change', this.handleusefile, false);\n            }\n\n            if (this.usefile.checked) {\n                document.getElementById('applet_options').style.display = \"block\";\n            } else {\n                document.getElementById('applet_options').style.display = \"none\";\n            }\n            this.initoptions();\n        },\n\n        callback: function(params) {\n            var elementname = M.core_filepicker.instances[params['client_id']].options.elementname;\n            $('#id_' + elementname).val(params.url);\n            // inject applet to div layer\n            var id = (params.file).split(\".\")[0];\n            if (id.indexOf(\"m\") == 0) {\n                if (this.isNumber(id.substr(1)) || (!this.isNumber(id.substr(1)) && id.length > 8)) {\n                    id = id.substr(1);\n                }\n            }\n            this.injectapplet(id);\n        },\n\n        injectapplet: function(id) {\n            this.parameters = {\"material_id\": id};\n            this.parameters.language = this.lang;\n            this.parameters.moodle = \"editingQuestionOrSubmission\";\n            // Since we only support HTML5 this should work for js-code in the applet to get executed (ggboninit).\n            this.parameters.useBrowserForJS = false;\n\n            document.getElementById('applet_container1').style.display = \"block\";\n\n            window.applet1 = new GGBApplet(this.parameters, true);\n            // window.applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.541.0/web3d\");\n            window.applet1.setHTML5Codebase(GGBcodebase);\n            window.applet1.inject(\"applet_container1\", \"preferHTML5\");\n\n        },\n\n        getrandvars: function() {\n            var applet = document.ggbApplet;\n            if (typeof applet !== 'undefined') {\n                var objNumber = applet.getObjectNumber();\n                var randomizedvar = document.getElementById('id_randomizedvar');\n                var stringforrandomizedvars = \"\";\n                var i = 0;\n                for (var j = 0; j < objNumber; j++) {\n                    var strName = applet.getObjectName(j);\n                    if (applet.getObjectType(strName) == \"numeric\" && applet.isIndependent(strName)) {\n                        stringforrandomizedvars += strName + \",\";\n                    } else {\n                        var answer = $('#id_answer_' + i);\n                        if (applet.getObjectType(strName) == \"boolean\") {\n                            if (answer !== null) {\n                                if (!answer.val()) {\n                                    answer.val(strName);\n                                }\n                                this.update_feedback(answer);\n                                i++;\n                            }\n                        }\n                    }\n                    randomizedvar.value = stringforrandomizedvars;\n                }\n            }\n        },\n\n        update_feedback: function(answernode) {\n            var id = answernode.attr('id').split(\"_\").pop();\n            var varname = answernode.val();\n            var feedback = $('input[name=\"feedback[' + id + ']\"]');\n            var feedbackfromfile = $('#id_feedbackfromfile_' + id);\n            var doc = $.parseXML(window.ggbApplet.getXML(varname));\n            if (doc) {\n                var elem = doc.getElementsByTagName('caption');\n                var fbstring = '';\n                if (elem.length == 1) {\n                    fbstring = elem[0].getAttribute('val');\n                    feedback.val(fbstring);\n                } else if (elem.length > 1) {\n                    feedback.val('');\n                    fbstring = '';\n                } else {\n                    feedback.val('');\n                    //this is rather an error condition but should be checked by the server\n                    fbstring = 'Caption not set or variable name wrong.';\n                }\n                feedbackfromfile.val(fbstring);\n            }\n        },\n\n        checkEnter: function(e) {\n            e = e || event;\n            var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);\n            return txtArea || (e.keyCode || e.which || e.charCode || 0) !== 13;\n        },\n\n        initoptions: function() {\n            this.enable_right_click = document.getElementById('enableRightClick');\n            this.enable_label_drags = document.getElementById('enableLabelDrags');\n            this.show_reset_icon = document.getElementById('showResetIcon');\n            this.enable_shift_drag_zoom = document.getElementById('enableShiftDragZoom');\n            this.show_algebra_input = document.getElementById('showAlgebraInput');\n            this.show_menu_bar = document.getElementById('showMenuBar');\n            this.show_tool_bar = document.getElementById('showToolBar');\n\n            if (typeof parameters !== 'undefined') {\n                this.enable_right_click.checked = this.parameters.enableRightClick;\n                this.enable_label_drags.checked = this.parameters.enableLabelDrags;\n                this.show_reset_icon.checked = this.parameters.showResetIcon;\n                this.enable_shift_drag_zoom.checked = this.parameters.enableShiftDragZoom;\n                this.show_algebra_input.checked = this.parameters.showAlgebraInput;\n                this.show_menu_bar.checked = this.parameters.showMenuBar;\n                this.show_tool_bar.checked = this.parameters.showToolBar;\n            }\n\n            this.enable_right_click.addEventListener('change', this.handlesettingschanged, false);\n            this.enable_label_drags.addEventListener('change', this.handlesettingschanged, false);\n            this.show_reset_icon.addEventListener('change', this.handlesettingschanged, false);\n            this.enable_shift_drag_zoom.addEventListener('change', this.handlesettingschanged, false);\n            this.show_algebra_input.addEventListener('change', this.handlesettingschanged, false);\n            this.show_menu_bar.addEventListener('change', this.handlesettingschanged, false);\n            this.show_tool_bar.addEventListener('change', this.handlesettingschanged, false);\n        },\n\n        handlesettingschanged: function(evt) {\n            window.GGBT.parameters[evt.target.id] = (evt.target.checked);\n            $('input[name=\"ggbparameters\"]').val(JSON.stringify(window.GGBT.parameters));\n            if (evt.target.id == \"showToolBar\" || evt.target.id == \"showMenuBar\" || evt.target.id == \"showAlgebraInput\") {\n                window.applet1 = new GGBApplet(window.GGBT.parameters, true);\n                // window.applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.541.0/web3d\");\n                window.applet1.setHTML5Codebase(GGBcodebase);\n                window.applet1.inject(\"applet_container1\", \"preferHTML5\");\n            } else {\n                window.ggbApplet[evt.target.id](evt.target.checked);\n            }\n        },\n\n        handleusefile: function() {\n            if (!window.GGBT.usefile.checked) {\n                document.getElementById('applet_container1').style.display = \"none\";\n                document.getElementById('applet_options').style.display = \"none\";\n            } else {\n                document.getElementById('id_ggbturl').value = \"\";\n                // document.getElementById('applet_container1').style.display = \"block\";\n            }\n        },\n\n        handleggbdisable: function() {\n            if (!window.GGBT.ggbcheckb.checked) {\n                document.getElementById('applet_container1').style.display = \"none\";\n                document.getElementById('applet_options').style.display = \"none\";\n                if (window.GGBT.usefile.checked) {\n                    window.GGBT.usefile.click();\n                }\n            } else {\n                document.getElementById('applet_container1').style.display = \"block\";\n            }\n        },\n\n        handleDragEnter: function() {\n            if (typeof (ggbcheckb) == \"undefined\" || window.GGBT.ggbcheckb.checked) {\n                window.GGBT.ggbf.classList.add('qtype-geogebra-hover');\n                document.getElementById('applet_container1').style.visibility = \"hidden\";\n            }\n        },\n\n        handleDragOver: function(e) {\n            if (typeof (window.GGBT.ggbcheckb) == \"undefined\" || window.GGBT.ggbcheckb.checked) {\n                if (e.preventDefault) {\n                    e.preventDefault();\n                }\n                window.GGBT.ggbf.classList.add('qtype-geogebra-hover');\n                document.getElementById('applet_container1').style.visibility = \"hidden\";\n                return false;\n            }\n        },\n\n        handleDragEndLeave: function() {\n            if (typeof (window.GGBT.ggbcheckb) == \"undefined\" || window.GGBT.ggbcheckb.checked) {\n                window.GGBT.ggbf.classList.remove('qtype-geogebra-hover');\n                document.getElementById('applet_container1').style.removeProperty(\"visibility\");\n            }\n        },\n\n        handleDrop: function(e) {\n            if (typeof (window.GGBT.ggbcheckb) == \"undefined\" || window.GGBT.ggbcheckb.checked) {\n                e.preventDefault();\n                e.stopPropagation();\n                var file = e.dataTransfer.files[0];\n                window.GGBT.ggbf.classList.remove('qtype-geogebra-hover');\n                document.getElementById('applet_container1').style.removeProperty(\"visibility\");\n                document.getElementById('applet_container1').style.display = \"block\";\n                document.getElementById('applet_options').style.display = \"flex\";\n                document.getElementById('applet_container1').style.height = \"100%\";\n                //document.getElementById('applet_container1').style.width = \"100%\";\n\n                document.getElementById('id_ggbturl').value = \"\";\n                //this.usefile = document.getElementById(\"id_usefile\");\n                if (!window.GGBT.usefile.checked) {\n                    window.GGBT.usefile.click();\n                }\n                var reader = new FileReader();\n                reader.onload = function(event) {\n                    var base64 = event.target.result.replace(\"data:application/vnd.geogebra.file;base64,\", \"\");\n                    window.GGBT.parameters = {\"ggbBase64\": base64};\n                    window.GGBT.parameters.enableRightClick = window.GGBT.enable_right_click.checked;\n                    window.GGBT.parameters.enableLabelDrags = window.GGBT.enable_label_drags.checked;\n                    window.GGBT.parameters.showResetIcon = window.GGBT.show_reset_icon.checked;\n                    window.GGBT.parameters.enableShiftDragZoom = window.GGBT.enable_shift_drag_zoom.checked;\n                    window.GGBT.parameters.showAlgebraInput = window.GGBT.show_algebra_input.checked;\n                    window.GGBT.parameters.showMenuBar = window.GGBT.show_menu_bar.checked;\n                    window.GGBT.parameters.showToolBar = window.GGBT.show_tool_bar.checked;\n                    window.GGBT.parameters.moodle = \"editingQuestionOrSubmission\";\n                    window.applet1 = new GGBApplet(window.GGBT.parameters, true);\n                    // window.applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.541.0/web3d\");\n                    window.applet1.setHTML5Codebase(GGBcodebase);\n                    window.applet1.inject(\"applet_container1\");\n                };\n\n                reader.readAsDataURL(file);\n            }\n        },\n\n        isNumber: function(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n    };\n});\n"],"file":"ggbt.min.js"}